---
name: code-reviewer
description: 专业的代码审查助手，提供安全性、性能、可读性和最佳实践等多维度的代码审查，生成结构化的审查报告
---

# 代码审查助手 (Code Reviewer)

本 Skill 帮助你进行专业的代码审查，覆盖安全性、性能、可读性和最佳实践等多个维度。

## 触发条件

当用户请求以下类型的任务时，自动激活此 Skill：
- 审查代码
- 检查代码质量
- 发现代码问题
- 代码 Review
- 代码优化建议

## 审查流程

### 第一步：代码理解

1. 识别编程语言和框架
2. 理解代码的功能和目的
3. 识别代码的上下文（是否是 API、数据处理、用户界面等）

### 第二步：安全性检查

按以下清单进行安全性审查：

#### 注入攻击
- [ ] SQL 注入：检查是否使用参数化查询
- [ ] 命令注入：检查是否存在未过滤的系统命令执行
- [ ] XSS：检查用户输入是否正确转义

#### 敏感信息
- [ ] 硬编码凭据：检查是否存在硬编码的密码、API Key 等
- [ ] 日志泄露：检查日志中是否可能打印敏感信息
- [ ] 错误信息：检查错误响应是否泄露内部信息

#### 权限控制
- [ ] 认证：检查是否存在认证绕过风险
- [ ] 授权：检查是否存在越权访问风险
- [ ] 输入验证：检查是否对用户输入进行充分验证

### 第三步：性能检查

#### 算法效率
- [ ] 时间复杂度：识别可能的 O(n²) 或更高复杂度的操作
- [ ] 空间复杂度：检查内存使用是否合理

#### 数据库操作
- [ ] N+1 查询：检查循环内的数据库查询
- [ ] 索引使用：建议可能需要的索引
- [ ] 批量操作：建议将多次操作合并为批量操作

#### 资源管理
- [ ] 连接泄漏：检查数据库/网络连接是否正确关闭
- [ ] 内存泄漏：检查是否存在未释放的资源

### 第四步：可读性检查

#### 命名规范
- [ ] 变量命名：是否清晰表达含义
- [ ] 函数命名：是否准确描述功能
- [ ] 常量命名：是否使用大写和下划线

#### 代码结构
- [ ] 函数长度：单个函数是否超过 50 行
- [ ] 嵌套深度：是否存在超过 3 层的嵌套
- [ ] 单一职责：函数是否只做一件事

#### 注释
- [ ] 关键逻辑：复杂算法是否有注释说明
- [ ] API 文档：公共接口是否有文档
- [ ] TODO/FIXME：是否有未处理的标记

### 第五步：最佳实践检查

#### 错误处理
- [ ] 异常捕获：是否有适当的 try-catch
- [ ] 错误传播：错误是否被正确传递或处理
- [ ] 回退机制：关键操作是否有失败处理

#### 设计原则
- [ ] DRY：是否存在重复代码
- [ ] SOLID：是否违反单一职责等原则
- [ ] 设计模式：是否有更好的设计模式可用

#### 测试友好
- [ ] 可测试性：代码是否易于编写单元测试
- [ ] 依赖注入：是否使用依赖注入便于测试

## 输出格式

使用 `assets/review-template.md` 模板生成审查报告，包含：

1. **审查概要**：文件信息、时间、风险等级
2. **问题列表**：按严重程度分类
3. **修复建议**：包含具体代码示例
4. **总结**：整体评价和优先级建议

## 风险等级定义

| 图标 | 等级 | 说明 |
|------|------|------|
| 🔴 | 严重 | 安全漏洞、数据丢失风险，必须立即修复 |
| 🟠 | 高 | 性能问题、潜在 bug，应尽快修复 |
| 🟡 | 中 | 代码质量问题，建议在当前迭代修复 |
| 🟢 | 低 | 优化建议，可在后续迭代处理 |

## 示例

### 示例输入

```python
def login(username, password):
    query = f"SELECT * FROM users WHERE username='{username}' AND password='{password}'"
    user = db.execute(query).fetchone()
    if user:
        return {"status": "success", "user": user}
    return {"status": "fail"}
```

### 示例输出

参考 `assets/review-template.md` 模板生成结构化报告。

## 辅助工具

如需更深入的静态分析，可以运行：

```bash
python scripts/analyze_code.py <file_path>
```

## 参考资源

- 编码规范：`references/style-guide.md`
- 安全检查清单：本文档"安全性检查"部分
- 报告模板：`assets/review-template.md`

